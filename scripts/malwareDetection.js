$(function(){
    var allLinks = $('a');
    
    var css = document.createElement("style");
    css.type = "text/css";
    css.innerHTML = ".easysec_safe { color: green; } .easysec_risk { color: orange; } ";
    document.body.appendChild(css);
    
    var checkUrl = function(url, score) {
        
        var badurl = /japple/;
        if(badurl.test(url))
        {
            return "bad";
			alert('bad');
        }
		
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "http://api.mywot.com/0.4/public_link_json2?key=e5ac9b97503f006dff3c4c52280d971d73c1d352&hosts='" + url + "'", false);
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4) {
			   (xhr.responseText)
		  }
		}
		xhr.send();
        
        $.ajax({
            url: ,
            dataType: "jsonp",
            async:false,
            success: function(data) {
                var ret = "return";
                for(var i in data) {
                    for(var key in data[i].categories) {
                        if(key > 300) {
                            ret = "safe";
                        } else if(key > 200) {
                            ret = "risk";
                        } else {
                            ret = "bad";
                        }
                    }
                    break;
                }
                return ret;
            }
        });
    };
    
    allLinks.each(function() {
        if($(this).attr('href')) {
			var hrefl=$(this).attr('href');
            
            //skip links pointing to same page
            var pageRegex = new RegExp(location.origin);
            if(pageRegex.test(hrefl)){
                return;
            }
			if(hrefl.indexOf("http") != 0){
				return;				
			}
			
			console.log(hrefl);
            
            var category = checkUrl(hrefl);
			if(category == "bad") {
				$(this).attr('href',"#");
			} else if(category == "safe") {
    		    $(this).addClass("easysec_safe");
			} else {
    		    $(this).addClass("easysec_risk");
			}
        }
	});
});